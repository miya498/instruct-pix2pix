# InstructPix2Pix: ç”»åƒç·¨é›†æŒ‡ç¤ºã«å¾“ã†å­¦ç¿’ãƒ¢ãƒ‡ãƒ«
### [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒšãƒ¼ã‚¸](https://www.timothybrooks.com/instruct-pix2pix/) | [è«–æ–‡](https://arxiv.org/abs/2211.09800) | [ãƒ‡ãƒ¼ã‚¿](http://instruct-pix2pix.eecs.berkeley.edu/)
InstructPix2Pixã®PyTorchå®Ÿè£…ã§ã™ã€‚ã“ã‚Œã¯æŒ‡ç¤ºãƒ™ãƒ¼ã‚¹ã®ç”»åƒç·¨é›†ãƒ¢ãƒ‡ãƒ«ã§ã€å…ƒã®[CompVis/stable_diffusion](https://github.com/CompVis/stable-diffusion)ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã¾ã™ã€‚

[InstructPix2Pix: Learning to Follow Image Editing Instructions](https://www.timothybrooks.com/instruct-pix2pix/)  
 [Tim Brooks](https://www.timothybrooks.com/)\*,
 [Aleksander Holynski](https://holynski.org/)\*,
 [Alexei A. Efros](https://people.eecs.berkeley.edu/~efros/) <br>
 UC Berkeley <br>
  \*åŒç­‰ã®è²¢çŒ®ã‚’ç¤ºã™

  <img src='https://instruct-pix2pix.timothybrooks.com/teaser.jpg'/>

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ã€InstructPix2Pixã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€è‡ªåˆ†ã®ç”»åƒã§å®Ÿè¡Œã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ‰‹é †ã¯18GBä»¥ä¸Šã®VRAMã‚’æŒã¤GPUã§ãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚GPUã‚’ãŠæŒã¡ã§ãªã„å ´åˆã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã‹ã€[ãƒ¢ãƒ‡ãƒ«ã®ä»–ã®ä½¿ç”¨æ–¹æ³•](https://github.com/timothybrooks/instruct-pix2pix#other-ways-of-using-instructpix2pix)ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

### condaç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨äº‹å‰å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰:
```
conda env create -f environment.yaml
conda activate ip2p
bash scripts/download_checkpoints.sh
```

### å˜ä¸€ç”»åƒã®ç·¨é›†:
```
python edit_cli.py --input imgs/example.jpg --output imgs/output.jpg --edit "turn him into a cyborg"

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€çµæœã‚’èª¿æ•´ã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®šã§ãã¾ã™:
# python edit_cli.py --steps 100 --resolution 512 --seed 1371 --cfg-text 7.5 --cfg-image 1.2 --input imgs/example.jpg --output imgs/output.jpg --edit "turn him into a cyborg"
```

### ã¾ãŸã¯ã€ç‹¬è‡ªã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ç·¨é›†Gradioã‚¢ãƒ—ãƒªã‚’èµ·å‹•:
```
python edit_app.py 
```
![Edit app](https://github.com/timothybrooks/instruct-pix2pix/blob/main/imgs/edit_app.jpg?raw=true)

_(ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¿æ•´æ–¹æ³•ã«ã¤ã„ã¦ã¯ã€[ãƒ’ãƒ³ãƒˆ](https://github.com/timothybrooks/instruct-pix2pix#tips)ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„)_

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:
```
conda env create -f environment.yaml
```

äº‹å‰å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰:
```
bash scripts/download_checkpoints.sh
```

## ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ

ç§ãŸã¡ã®ç”»åƒç·¨é›†ãƒ¢ãƒ‡ãƒ«ã¯ã€454,445å€‹ã®ä¾‹ã‚’å«ã‚€ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã•ã‚Œã¦ã„ã¾ã™ã€‚å„ä¾‹ã¯ä»¥ä¸‹ã®è¦ç´ ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š(1)å…¥åŠ›ç”»åƒã€(2)ç·¨é›†æŒ‡ç¤ºã€(3)ç·¨é›†å¾Œã®å‡ºåŠ›ç”»åƒã€‚ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯2ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æä¾›ã—ã¦ã„ã¾ã™ï¼šå„ç·¨é›†ç”»åƒãƒšã‚¢ã‚’100å›ç”Ÿæˆã—ã€CLIPãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆè«–æ–‡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³3.1.2ï¼‰ã«åŸºã¥ã„ã¦æœ€è‰¯ã®ä¾‹ã‚’é¸æŠã—ãŸã‚‚ã®ï¼ˆ`clip-filtered-dataset`ï¼‰ã¨ã€ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã—ãŸä¾‹ï¼ˆ`random-sample-dataset`ï¼‰ã§ã™ã€‚

ãƒªãƒªãƒ¼ã‚¹ç‰ˆã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã¯ã€NSFWã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ç”»åƒã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã¾ã™ã€‚NSFWãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã€GPT-3ç”Ÿæˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ã¯451,990å€‹ã®ä¾‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚æœ€çµ‚çš„ãªç”»åƒãƒšã‚¢ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

|  | ç”»åƒç·¨é›†ä¾‹ã®æ•° | ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚µã‚¤ã‚º |
|--|-----------------------|----------------------- |
| `random-sample-dataset` |451990|727GB|
|  `clip-filtered-dataset` |313010|436GB|

ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ã„ãšã‚Œã‹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯ã€é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆåã‚’æŒ‡å®šã—ã¦ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

```
bash scripts/download_data.sh clip-filtered-dataset
```

## InstructPix2Pixã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°

InstructPix2Pixã¯ã€åˆæœŸã®StableDiffusionãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã¯Stable Diffusionãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã™ã€‚ç§ãŸã¡ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã§ã¯ã€v1.5ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’é–‹å§‹ç‚¹ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã—ãŸã€‚åŒã˜ã‚‚ã®ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

```
bash scripts/download_pretrained_sd.sh
```

ç•°ãªã‚‹ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ãŸã„å ´åˆã¯ã€`configs/train.yaml`ãƒ•ã‚¡ã‚¤ãƒ«ã®8è¡Œç›®ã€`ckpt_path:`ã®å¾Œã«æŒ‡å®šã—ã¦ãã ã•ã„ã€‚

æ¬¡ã«ã€è¨­å®šã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸï¼ˆã¾ãŸã¯ç”Ÿæˆã—ãŸï¼‰ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æŒ‡ã™ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¸Šè¨˜ã®`clip-filtered-dataset`ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã§ãã¾ã™ã€‚ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€è¨­å®šã®85è¡Œç›®ã¨94è¡Œç›®ï¼ˆ`data.params.train.params.path`ã€`data.params.validation.params.path`ï¼‰ã‚’ç·¨é›†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

æœ€å¾Œã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¸ãƒ§ãƒ–ã‚’é–‹å§‹ã—ã¾ã™ï¼š

```
python main.py --name default --base configs/train.yaml --train --gpus 0,1,2,3,4,5,6,7
```

## ç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ä½œæˆ

ãƒšã‚¢ã«ãªã£ãŸç”»åƒã¨ç·¨é›†æŒ‡ç¤ºã®ç”Ÿæˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯2æ®µéšã§ä½œæˆã•ã‚Œã¾ã™ï¼šã¾ãšã€GPT-3ã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã®ãƒˆãƒªãƒ—ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ï¼š(a)ç”»åƒã‚’èª¬æ˜ã™ã‚‹ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã€(b)ç·¨é›†æŒ‡ç¤ºã€(c)ç·¨é›†å¾Œã®ç”»åƒã‚’èª¬æ˜ã™ã‚‹ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã€‚æ¬¡ã«ã€Stable Diffusionã¨Prompt-to-Promptã‚’ä½¿ç”¨ã—ã¦ã€ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã®ãƒšã‚¢ï¼ˆç·¨é›†å‰/å¾Œï¼‰ã‚’ç”»åƒã®ãƒšã‚¢ã«å¤‰æ›ã—ã¾ã™ã€‚

### (1) ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¨æŒ‡ç¤ºã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ç”Ÿæˆ

ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¨ç·¨é›†æŒ‡ç¤ºã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯[ã“ã¡ã‚‰](https://instruct-pix2pix.eecs.berkeley.edu/gpt-generated-prompts.jsonl)ã§æä¾›ã—ã¦ã„ã¾ã™ã€‚ç§ãŸã¡ã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³+æŒ‡ç¤ºã‚’ä½¿ç”¨ã™ã‚‹äºˆå®šã®å ´åˆã¯ã€ã‚¹ãƒ†ãƒƒãƒ—(2)ã«é€²ã‚“ã§ãã ã•ã„ã€‚ãã‚Œä»¥å¤–ã«ç‹¬è‡ªã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½œæˆã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—(1.1-1.3)ã«å¾“ã£ã¦ãã ã•ã„ã€‚GPT-3ã‚’ä½¿ç”¨ã—ã¦éå¸¸ã«å¤§ããªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆã™ã‚‹ã®ã¯é«˜é¡ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

#### (1.1) æ‰‹å‹•ã§æŒ‡ç¤ºã¨ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½œæˆ

ãƒ—ãƒ­ã‚»ã‚¹ã®æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã¯GPT-3ã®ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã§ã™ã€‚ã“ã‚Œã‚’è¡Œã†ãŸã‚ã«ã€ç§ãŸã¡ã¯700å€‹ã®ä¾‹ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã¯ã€ãƒ¢ãƒ‡ãƒ«ãŒå®Ÿè¡Œã§ãã‚‹ç·¨é›†ã®å¹…åºƒã„ç¯„å›²ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚ç§ãŸã¡ã®ä¾‹ã¯[ã“ã¡ã‚‰](https://instruct-pix2pix.eecs.berkeley.edu/human-written-prompts.jsonl)ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚ã“ã‚Œã‚‰ã¯å¤šæ§˜ã§ã€å¯èƒ½ãªã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¨ç·¨é›†ã‚¿ã‚¤ãƒ—ã®å¹…åºƒã„ç¯„å›²ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã¹ãã§ã™ã€‚ç†æƒ³çš„ã«ã¯ã€ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¨æŒ‡ç¤ºã®é‡è¤‡ã‚„å¤§ããªé‡è¤‡ã‚’é¿ã‘ã‚‹ã¹ãã§ã™ã€‚ã¾ãŸã€Stable Diffusionã¨Prompt-to-Promptã®åˆ¶é™ï¼ˆã‚«ãƒ¡ãƒ©ã®ç§»å‹•ã€ã‚ºãƒ¼ãƒ ã‚¤ãƒ³ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½ç½®ã®å…¥ã‚Œæ›¿ãˆãªã©ã®å¤§ããªç©ºé–“å¤‰æ›ãŒã§ããªã„ãªã©ï¼‰ã‚’è€ƒæ…®ã—ã¦ä¾‹ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

å…¥åŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ã€ã‚ˆã‚Šå¤§ããªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚ŒãŸå…¥åŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®åˆ†å¸ƒã«å¯†æ¥ã«ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç§ãŸã¡ã¯700å€‹ã®å…¥åŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’_LAION Improved Aesthetics 6.5+_ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‹ã‚‰ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ã€ä¾‹ã®ç”Ÿæˆã«ã‚‚ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯ã‹ãªã‚Šãƒã‚¤ã‚ºãŒå¤šã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸï¼ˆå¤šãã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ãŒé•·ã™ãã€ç„¡é–¢ä¿‚ãªãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚“ã§ã„ã¾ã™ï¼‰ã€‚ã“ã®ãŸã‚ã€MSCOCOã¨LAION-COCOãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚‚æ¤œè¨ã—ã¾ã—ãŸãŒã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€å›ºæœ‰åè©ã€ã‚¢ãƒ¼ãƒˆãƒ¡ãƒ‡ã‚£ã‚¢ã®å¤šæ§˜æ€§ã‚’è€ƒæ…®ã—ã¦ã€æœ€çµ‚çš„ã«_LAION Improved Aesthetics 6.5+_ã‚’é¸æŠã—ã¾ã—ãŸã€‚GPT-3ã§ä¾‹ã‚’ç”Ÿæˆã™ã‚‹éš›ã«åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚„ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®çµ„ã¿åˆã‚ã›ã‚’å…¥åŠ›ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¾‹ã‚’æ‰‹å‹•ã§ä½œæˆã™ã‚‹éš›ã«åŒã˜åˆ†å¸ƒã‹ã‚‰å…¥åŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

#### (1.2) GPT-3ã®ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€æ‰‹å‹•ã§ä½œæˆã—ãŸæŒ‡ç¤º/å‡ºåŠ›ã§å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ã‚’ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã€æ–°ã—ã„å…¥åŠ›ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰ç·¨é›†æŒ‡ç¤ºã¨ç·¨é›†å¾Œã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã¯ã€OpenAI APIã‚’ä»‹ã—ã¦GPT-3ã®Davinciãƒ¢ãƒ‡ãƒ«ã‚’ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¾ã™ãŒã€ä»–ã®è¨€èªãƒ¢ãƒ‡ãƒ«ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚

GPT-3ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã™ã‚‹ã«ã¯ã€ã¾ãšOpenAIé–‹ç™ºè€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦å¿…è¦ãªAPIã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€[ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã«APIã‚­ãƒ¼ã‚’è¨­å®š](https://beta.openai.com/docs/api-reference/introduction)ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€`prompts/prepare_for_gpt.py`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ã€æŒ‡ç¤ºã¨ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’é€£çµã—ã€åŒºåˆ‡ã‚Šæ–‡å­—ã¨åœæ­¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ­£ã—ã„å½¢å¼ã«å¤‰æ›ã—ã¾ã™ã€‚

```bash
python dataset_creation/prepare_for_gpt.py --input-path data/human-written-prompts.jsonl --output-path data/human-written-prompts-for-gpt.jsonl
```

æ¬¡ã«ã€OpenAI CLIã‚’ä»‹ã—ã¦GPT-3ã‚’ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¾ã™ã€‚ä»¥ä¸‹ã«ä¾‹ã‚’ç¤ºã—ã¾ã™ãŒã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯å¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€OpenAIã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚Davinciãƒ¢ãƒ‡ãƒ«ã‚’1ã‚¨ãƒãƒƒã‚¯ã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¾ã—ãŸã€‚ã‚ˆã‚Šå°ã•ãã€ã‚ˆã‚Šå®‰ä¾¡ãªGPT-3ãƒãƒªã‚¢ãƒ³ãƒˆã‚„ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®è¨€èªãƒ¢ãƒ‡ãƒ«ã§å®Ÿé¨“ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€ã“ã‚Œã«ã‚ˆã‚Šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ä¸‹ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```bash
openai api fine_tunes.create -t data/human-written-prompts-for-gpt.jsonl -m davinci --n_epochs 1 --suffix "instruct-pix2pix"
```

æä¾›ã•ã‚Œã¦ã„ã‚‹Gradioã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸGPT-3ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ï¼š

```bash
python prompt_app.py --openai-api-key OPENAI_KEY --openai-model OPENAI_MODEL_NAME
```

![Prompt app](https://github.com/timothybrooks/instruct-pix2pix/blob/main/imgs/prompt_app.jpg?raw=true)

#### (1.3) ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¨æŒ‡ç¤ºã®å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ç”Ÿæˆ

ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸGPT-3ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€å¤§è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚ç§ãŸã¡ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯æ•°åƒãƒ‰ãƒ«ã®ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚Šã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®ä¾‹ã‚’ç”Ÿæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¤ã„ã¦ã¯`prompts/gen_instructions_and_captions.py`ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã¾ãšã€`--num-samples`ã«ä½ã„å€¤ã‚’è¨­å®šã—ã¦å°‘æ•°ã®ä¾‹ã‚’ç”Ÿæˆã—ã€å¾ã€…ã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å¢—ã‚„ã—ã¦ã€ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å¢—ã‚„ã™å‰ã«çµæœãŒæœŸå¾…é€šã‚Šã«æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

```bash
python dataset_creation/generate_txt_dataset.py --openai-api-key OPENAI_KEY --openai-model OPENAI_MODEL_NAME
```

éå¸¸ã«å¤§ããªã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆä¾‹ï¼š100K+ï¼‰ã§ç”Ÿæˆã™ã‚‹å ´åˆã€è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ä¸¦åˆ—ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ç”ŸæˆãŒå¤§å¹…ã«é«˜é€ŸåŒ–ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯`--partitions=N`ã‚’ã‚ˆã‚Šé«˜ã„æ•°ã«è¨­å®šã—ã€å„`--partition`ã‚’å¯¾å¿œã™ã‚‹å€¤ã«è¨­å®šã—ã¦è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã¾ã™ã€‚

```bash
python dataset_creation/generate_txt_dataset.py --openai-api-key OPENAI_KEY --openai-model OPENAI_MODEL_NAME --partitions=10 --partition=0
```

### (2) ãƒšã‚¢ã«ãªã£ãŸã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ãƒšã‚¢ã«ãªã£ãŸç”»åƒã«å¤‰æ›

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€ãƒ†ã‚­ã‚¹ãƒˆã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã®ãƒšã‚¢ã‚’ç”»åƒã®ãƒšã‚¢ã«å¤‰æ›ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã¯ã€äº‹å‰å­¦ç¿’æ¸ˆã¿ã®Stable Diffusionãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’`stable_diffusion/models/ldm/stable-diffusion-v1/`ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¸Šè¨˜ã®æ‰‹é †ã«å¾“ã£ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¡Œã£ãŸå ´åˆã¯æ—¢ã«å®Œäº†ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãã†ã§ãªã„å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```bash
bash scripts/download_pretrained_sd.sh
```

ç§ãŸã¡ã®ãƒ¢ãƒ‡ãƒ«ã§ã¯ã€[ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆv1.5](https://huggingface.co/runwayml/stable-diffusion-v1-5/blob/main/v1-5-pruned.ckpt)ã¨[æ–°ã—ã„ã‚ªãƒ¼ãƒˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼](https://huggingface.co/stabilityai/sd-vae-ft-mse-original/resolve/main/vae-ft-mse-840000-ema-pruned.ckpt)ã‚’ä½¿ç”¨ã—ã¾ã—ãŸãŒã€ä»–ã®ãƒ¢ãƒ‡ãƒ«ã‚‚æ©Ÿèƒ½ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä»–ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€`--ckpt`ã¨`--vae-ckpt`å¼•æ•°ã‚’æ¸¡ã—ã¦ã€å¯¾å¿œã™ã‚‹ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆã§ãã¾ã™ï¼š

```
python dataset_creation/generate_img_dataset.py --out_dir data/instruct-pix2pix-dataset-000 --prompts_file path/to/generated_prompts.jsonl
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯å˜ä¸€ã®GPUï¼ˆé€šå¸¸ã¯V100ã¾ãŸã¯A100ï¼‰ã§å‹•ä½œã—ã¾ã™ã€‚å¤šãã®GPU/ãƒã‚·ãƒ³ã§ä¸¦åˆ—åŒ–ã™ã‚‹ã«ã¯ã€`--n-partitions`ã‚’ä¸¦åˆ—ã‚¸ãƒ§ãƒ–ã®ç·æ•°ã«è¨­å®šã—ã€`--partition`ã‚’å„ã‚¸ãƒ§ãƒ–ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«è¨­å®šã—ã¾ã™ã€‚

```
python dataset_creation/generate_img_dataset.py --out_dir data/instruct-pix2pix-dataset-000 --prompts_file path/to/generated_prompts.jsonl --n-partitions 100 --partition 0
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ç§ãŸã¡ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¨ä¸€è‡´ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã«ã¯ã‚ˆã‚Šå°‘ãªã„ã‚¹ãƒ†ãƒƒãƒ—æ•°ï¼ˆä¾‹ï¼š`--steps=25`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€é«˜å“è³ªãªãƒ‡ãƒ¼ã‚¿ã‚’ã‚ˆã‚Šé€Ÿãç”Ÿæˆã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã”ã¨ã«100å€‹ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ç”Ÿæˆã—ã€CLIPãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã”ã¨ã«æœ€å¤§4å€‹ã‚’ä¿æŒã—ã¾ã™ã€‚`--n-samples`ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå°‘ãªã„ã‚µãƒ³ãƒ—ãƒ«æ•°ã§å®Ÿé¨“ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã¯CLIPãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’å®Œå…¨ã«ç„¡åŠ¹ã«ã—ã€ã—ãŸãŒã£ã¦ã‚ˆã‚Šé«˜é€Ÿã§ã™ï¼š

```
python dataset_creation/generate_img_dataset.py --out_dir data/instruct-pix2pix-dataset-000 --prompts_file path/to/generated_prompts.jsonl --n-samples 4 --clip-threshold 0 --clip-dir-threshold 0 --clip-img-threshold 0 --n-partitions 100 --partition 0
```

ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä¾‹ã‚’ç”Ÿæˆã—ãŸå¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¾‹ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã¯ã€å„ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å®Ÿè¡Œã®é–‹å§‹æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã‚’åå¾©å‡¦ç†ã™ã‚‹å¿…è¦ãªãã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒåŠ¹ç‡çš„ã«ä¾‹ã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚

```
python dataset_creation/prepare_dataset.py data/instruct-pix2pix-dataset-000
```

## è©•ä¾¡

è«–æ–‡ã®å›³8ã¨10ã®ã‚ˆã†ãªãƒ—ãƒ­ãƒƒãƒˆã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

```
python metrics/compute_metrics.py --ckpt /path/to/your/model.ckpt
```

## ãƒ’ãƒ³ãƒˆ

æœŸå¾…ã™ã‚‹å“è³ªã®çµæœãŒå¾—ã‚‰ã‚Œãªã„å ´åˆã€ä»¥ä¸‹ã®ç†ç”±ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ï¼š

1. **ç”»åƒã®å¤‰åŒ–ãŒååˆ†ã§ãªã„å ´åˆ**ï¼šImage CFGã®é‡ã¿ãŒé«˜ã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®å€¤ã¯å‡ºåŠ›ãŒå…¥åŠ›ã«ã©ã‚Œã ã‘ä¼¼ã¦ã„ã‚‹ã¹ãã‹ã‚’ç¤ºã—ã¾ã™ã€‚ç·¨é›†ã«å…ƒã®ç”»åƒã‹ã‚‰ã®å¤§ããªå¤‰æ›´ãŒå¿…è¦ãªå ´åˆã€Image CFGã®é‡ã¿ãŒãã‚Œã‚’è¨±å®¹ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã¯ã€Text CFGã®é‡ã¿ãŒä½ã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®å€¤ã¯ãƒ†ã‚­ã‚¹ãƒˆæŒ‡ç¤ºã«ã©ã‚Œã ã‘å¾“ã†ã‹ã‚’ç¤ºã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Image CFG 1.5ã¨Text CFG 7.5ã¯è‰¯ã„å‡ºç™ºç‚¹ã§ã™ãŒã€å„ç·¨é›†ã«æœ€é©ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚ä»¥ä¸‹ã‚’è©¦ã—ã¦ãã ã•ã„ï¼š
    * Image CFGã®é‡ã¿ã‚’ä¸‹ã’ã‚‹ã€ã¾ãŸã¯
    * Text CFGã®é‡ã¿ã‚’ä¸Šã’ã‚‹ã€ã¾ãŸã¯

2. é€†ã«ã€**ç”»åƒã®å¤‰åŒ–ãŒå¤§ãã™ãã‚‹**å ´åˆï¼ˆå…ƒã®ç”»åƒã®è©³ç´°ãŒä¿æŒã•ã‚Œã¦ã„ãªã„ï¼‰ï¼šä»¥ä¸‹ã‚’è©¦ã—ã¦ãã ã•ã„ï¼š
    * Image CFGã®é‡ã¿ã‚’ä¸Šã’ã‚‹ã€ã¾ãŸã¯
    * Text CFGã®é‡ã¿ã‚’ä¸‹ã’ã‚‹

3. "Randomize Seed"ã‚’è¨­å®šã—ã¦ç•°ãªã‚‹ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒ¼ãƒ‰ã§çµæœã‚’ç”Ÿæˆã—ã¦ã¿ã¦ãã ã•ã„ã€‚ã¾ãŸã€"Randomize CFG"ã‚’è¨­å®šã—ã¦ã€æ¯å›æ–°ã—ã„Text CFGã¨Image CFGã®å€¤ã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

4. æŒ‡ç¤ºã®è¨€ã„å›ã—ã‚’å¤‰ãˆã‚‹ã¨çµæœãŒæ”¹å–„ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼ˆä¾‹ï¼šã€Œturn him into a dogã€vs.ã€Œmake him a dogã€vs.ã€Œas a dogã€ï¼‰ã€‚

5. ã‚¹ãƒ†ãƒƒãƒ—æ•°ã‚’å¢—ã‚„ã™ã¨çµæœãŒæ”¹å–„ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

6. é¡”ãŒãŠã‹ã—ãè¦‹ãˆã‚‹å ´åˆï¼šStable Diffusionã®ã‚ªãƒ¼ãƒˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã¯ã€ç”»åƒå†…ã§å°ã•ãªé¡”ã‚’å‡¦ç†ã™ã‚‹ã®ãŒè‹¦æ‰‹ã§ã™ã€‚é¡”ãŒãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚ˆã‚Šå¤§ããªéƒ¨åˆ†ã‚’å ã‚ã‚‹ã‚ˆã†ã«ç”»åƒã‚’ã‚¯ãƒ­ãƒƒãƒ—ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## ã‚³ãƒ¡ãƒ³ãƒˆ

- ç§ãŸã¡ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã¯[Stable Diffusionã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹](https://github.com/CompVis/stable-diffusion)ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã¾ã™ã€‚

## BibTeX

```
@article{brooks2022instructpix2pix,
  title={InstructPix2Pix: Learning to Follow Image Editing Instructions},
  author={Brooks, Tim and Holynski, Aleksander and Efros, Alexei A},
  journal={arXiv preprint arXiv:2211.09800},
  year={2022}
}
```

## InstructPix2Pixã®ä»–ã®ä½¿ç”¨æ–¹æ³•

### [HuggingFace](https://huggingface.co/spaces/timbrooks/instruct-pix2pix)ã§ã®InstructPix2Pix:
> ãƒ‡ãƒ¢ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ[HuggingFace space](https://huggingface.co/spaces/timbrooks/instruct-pix2pix)ã¨ã—ã¦åˆ©ç”¨å¯èƒ½ã§ã™ã€‚ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã€ç·¨é›†ã—ãŸã„ç”»åƒã€æŒ‡ç¤ºã ã‘ãŒå¿…è¦ã§ã™ï¼ã“ã‚Œã¯å…±æœ‰ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¢ã§ã‚ã‚Šã€ãƒ”ãƒ¼ã‚¯æ™‚ã®åˆ©ç”¨æ™‚ã«ã¯å‡¦ç†æ™‚é–“ãŒé…ããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

### [Replicate](https://replicate.com/timothybrooks/instruct-pix2pix)ã§ã®InstructPix2Pix:
> Replicateã¯ã€InstructPix2Pixãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®æœ¬ç•ªç’°å¢ƒå¯¾å¿œã®ã‚¯ãƒ©ã‚¦ãƒ‰APIã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚cURLã€Pythonã€JavaScriptã€ã¾ãŸã¯ä»»æ„ã®è¨€èªã‚’ä½¿ç”¨ã—ã¦ã€ã‚·ãƒ³ãƒ—ãƒ«ãªAPIã‚³ãƒ¼ãƒ«ã§ãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚Replicateã¯ã¾ãŸã€ãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿè¡Œã—ã¦äºˆæ¸¬ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã®Webã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚‚æä¾›ã—ã¦ã„ã¾ã™ã€‚

### [Imaginairy](https://github.com/brycedrennan/imaginAIry#-edit-images-with-instructions-alone-by-instructpix2pix)ã§ã®InstructPix2Pix:
> Imaginairyã¯ã€InstructPix2Pixã‚’ç°¡å˜ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹åˆ¥ã®æ–¹æ³•ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚GPUã®ãªã„ãƒ‡ãƒã‚¤ã‚¹ï¼ˆMacbookãªã©ï¼‰ã§ã‚‚å®Ÿè¡Œã§ãã¾ã™ï¼
> ```bash
> pip install imaginairy --upgrade
> aimg edit any-image.jpg --gif "turn him into a cyborg" 
> ```
> ã¾ãŸã€ç”»åƒã«å¯¾ã—ã¦è¤‡æ•°ã®ç·¨é›†ã‚’ç°¡å˜ã«å®Ÿè¡Œã—ã€ç·¨é›†ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³GIFã¨ã—ã¦ä¿å­˜ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š
> ```
> aimg edit --gif --surprise-me pearl-earring.jpg 
> ```
> <img src="https://raw.githubusercontent.com/brycedrennan/imaginAIry/7c05c3aae2740278978c5e84962b826e58201bac/assets/girl_with_a_pearl_earring_suprise.gif" width="512">

### [ğŸ§¨ Diffusers](https://github.com/huggingface/diffusers)ã§ã®InstructPix2Pix:

> Diffusersã§ã®InstructPix2Pixã¯å°‘ã—æœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚ˆã‚Šé«˜é€Ÿã§ã€ãƒ¡ãƒ¢ãƒªã®å°‘ãªã„GPUã«ã‚ˆã‚Šé©ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ç”»åƒã®ç·¨é›†ã®æ‰‹é †ã§ã™ï¼š
> 1. diffusersã¨é–¢é€£ã™ã‚‹ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š
>
> ```bash
> pip install transformers accelerate torch
>
> pip install git+https://github.com/huggingface/diffusers.git
> ```
> 
> 2. ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ç”»åƒã‚’ç·¨é›†ï¼š
>
> ```python
> 
> import torch
> from diffusers import StableDiffusionInstructPix2PixPipeline, EulerAncestralDiscreteScheduler
> 
> model_id = "timbrooks/instruct-pix2pix"
> pipe = StableDiffusionInstructPix2PixPipeline.from_pretrained(model_id, torch_dtype=torch.float16, safety_checker=None)
> pipe.to("cuda")
> pipe.scheduler = EulerAncestralDiscreteScheduler.from_config(pipe.scheduler.config)
> # `image`ã¯RGB PIL.Imageã§ã™
``` 